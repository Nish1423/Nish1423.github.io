import { useMemo, useState } from 'react'
import { Link, useLocation } from 'react-router-dom'
import { useStore } from '../store/store'
import BeanForm from '../components/forms/BeanForm'
import { Bean } from '../types'
function useQuery(){ const {search}=useLocation(); return useMemo(()=>new URLSearchParams(search),[search]) }
export default function Beans(){ const q=useQuery().get('search')?.toLowerCase() ?? ''; const beans=useStore(s=>s.beans); const addBean=useStore(s=>s.addBean); const updateBean=useStore(s=>s.updateBean); const deleteBean=useStore(s=>s.deleteBean); const [showForm,setShowForm]=useState(false); const filtered=beans.filter(b=> b.name.toLowerCase().includes(q)||(b.roaster??'').toLowerCase().includes(q)||(b.originCountry??'').toLowerCase().includes(q))
  return (<div className="space-y-4"><div className="flex items-center justify-between"><h1 className="text-xl font-semibold">Beans</h1><div className="flex gap-2"><button className="btn" onClick={()=>setShowForm(v=>!v)}>+ Add New Bean</button></div></div>{showForm&&(<div className="card"><BeanForm onSubmit={(b)=>{ addBean(b as Bean); setShowForm(false) }} /></div>)}<div className="grid gap-2"><div className="grid grid-cols-6 text-xs text-neutral-400 px-2"><div>Name</div><div>Roaster</div><div>Origin</div><div>Process</div><div>Roast</div><div>Tried</div></div>{filtered.map(b=>(<div className="grid grid-cols-6 items-center bg-neutral-900/60 border border-neutral-800 rounded-xl px-2 py-2" key={b.id}><div className="truncate"><Link className="hover:underline" to={'/beans/'+b.id}>{b.name}</Link></div><div className="truncate">{b.roaster ?? '—'}</div><div>{b.originCountry}</div><div>{b.process ?? '—'}</div><div>{b.roastLevel ?? '—'}</div><div><input type="checkbox" checked={b.tried} onChange={e=>updateBean(b.id,{tried:e.target.checked})}/></div></div>))}</div></div>) }