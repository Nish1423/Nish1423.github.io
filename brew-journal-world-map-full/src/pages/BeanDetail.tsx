import { useParams, Link } from 'react-router-dom'
import { useStore } from '../store/store'
import BrewForm from '../components/forms/BrewForm'
import { useState } from 'react'
import { Brew } from '../types'
export default function BeanDetail(){ const { id } = useParams(); const bean=useStore(s=>s.beans.find(b=>b.id===id)); const addBrew=useStore(s=>s.addBrew); const deleteBean=useStore(s=>s.deleteBean); const brews=useStore(s=>s.brews.filter(b=>b.beanId===id)); const [open,setOpen]=useState(false); if(!bean) return <div className="card">Bean not found. <Link to="/beans" className="underline">Back</Link></div>
  return (<div className="space-y-4"><div className="flex items-center justify-between"><h1 className="text-xl font-semibold">{bean.name}</h1><div className="flex gap-2"><button className="btn" onClick={()=>setOpen(v=>!v)}>Make New Brew</button><button className="btn" onClick={()=>{ if(confirm('Delete bean?')){ deleteBean(bean.id); location.hash='#/beans' }}}>Delete Bean</button></div></div><div className="grid md:grid-cols-2 gap-4"><div className="card"><div className="text-sm text-neutral-300">Origin: {bean.originRegion?bean.originRegion+', ':''}{bean.originCountry}</div><div className="text-sm text-neutral-300">Process: {bean.process ?? '—'}</div><div className="text-sm text-neutral-300">Notes: {bean.tastingNotes?.join(', ') || '—'}</div><div className="text-sm text-neutral-300">Tried: <input type="checkbox" checked={bean.tried} onChange={e=>useStore.getState().updateBean(bean.id,{tried:e.target.checked})} /></div></div><div className="card"><h3 className="font-medium mb-2">Brews</h3><div className="space-y-2">{brews.map(br=>(<div key={br.id} className="bg-neutral-900/60 border border-neutral-800 rounded-xl px-3 py-2"><div className="text-sm">{br.date} — {br.method} — {br.doseG}g → {br.waterG}g</div><div className="text-xs text-neutral-400">{br.notes ?? '—'}</div></div>))}{brews.length===0&&<div className="text-sm text-neutral-400">No brews yet.</div>}</div></div></div>{open&&(<div className="card"><BrewForm defaultValues={{beanId:bean.id}} onSubmit={(b)=>{ addBrew({ ...b, beanId: bean.id } as Brew); setOpen(false) }} /></div>)}</div>) }